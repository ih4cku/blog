<!DOCTYPE html>
<html lang="en">

<head>
  <!-- ## for client-side less
  <link rel="stylesheet/less" type="text/css" href="http://neurocoder.me/theme/css/style.less">
  <script src="http://cdnjs.cloudflare.com/ajax/libs/less.js/1.7.3/less.min.js" type="text/javascript"></script>
  -->
  <link rel="stylesheet" type="text/css" href="http://neurocoder.me/theme/css/style.css">
  <link rel="stylesheet" type="text/css" href="http://neurocoder.me/theme/css/pygments.css">
  <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=PT+Sans|PT+Serif|PT+Mono">

  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="author" content="neurocoder">
  <meta name="description" content="Posts and writings by neurocoder">

  <link href="http://neurocoder.me/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="neurocoder's notes Atom" />

<meta name="keywords" content="c++">

  <title>
    neurocoder's notes
&ndash; smart pointers  </title>

</head>

<body>
  <aside>
    <div id="user_meta">
      <a href="http://neurocoder.me">
        <img src="/favicon.ico" alt="logo">
      </a>
      <h2><a href="http://neurocoder.me">neurocoder</a></h2>
      <p>Record my thoughts</p>
      <ul>
        <li><a href="/categories.html">categories</a></li>
        <li><a href="/tags.html">tags</a></li>
        <li><a href="http://neurocoder.me/pages/about.html">about</a></li>
      </ul>
    </div>
  </aside>

  <main>
    <header>
      <p>
      <a href="http://neurocoder.me">Index</a> &brvbar; <a href="http://neurocoder.me/posts/index.html">Archives</a>
      &brvbar; <a href="http://neurocoder.me/feeds/all.atom.xml">Atom</a>
      </p>
    </header>

<article>
  <div class="article_title">
    <h3><a href="http://neurocoder.me/posts/2016/02/cpp-smart-pointers.html">smart pointers</a></h3>
  </div>
  <div class="article_text">
    <blockquote>
<p>2016-02-26 23:04:16</p>
</blockquote>
<h2><code>shared_ptr</code></h2>
<ul>
<li>cycle problem</li>
</ul>
<h2><code>weak_ptr</code></h2>
<ul>
<li>advantage over a regular raw pointer is that you can safely tell whether <code>weak_ptr</code> is dangling or not</li>
<li>just observe the object, doesn't affect the lifetime</li>
<li>can only be created from a <code>shared_ptr</code> or another <code>weak_ptr</code></li>
<li>can't dereference </li>
<li>neither <code>*</code> nor <code>-&gt;</code> is defined</li>
<li>can't access the raw pointer, no <code>get()</code> function</li>
<li>can only be set to empty state with <code>reset()</code> not by assigning to <code>nullptr</code></li>
<li>can only be used as a <code>shared_ptr</code> by <code>lock()</code></li>
</ul>
<h2><code>unique_ptr</code>?</h2>
<ul>
<li>zero overhead</li>
<li>unique ownership<ul>
<li>can be transferred around but only be owned by one owner at a time</li>
<li>the unique ownership is enforced by disallowing copy and assignment</li>
<li>if used as function argument, must by reference</li>
<li>ownership can only be transfered with move semantics <ul>
<li>as an <code>rvalue</code> with <code>std::move()</code> or a returned value</li>
<li>after transferring, the original owner becomes <code>nullptr</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<h3>references</h3>
<ul>
<li><a href="https://github.com/isocpp/CppCoreGuidelines/blob/master/CppCoreGuidelines.md#r-resource-management">R: Resource management - C++ Core Guidelines</a></li>
<li><a href="http://www.umich.edu/~eecs381/handouts/C++11_smart_ptrs.pdf">Using C++11's Smart Pointers</a></li>
<li><a href="http://www.drdobbs.com/cpp/c11-uniqueptr/240002708">C++11: unique_ptr</a></li>
<li><a href="https://akrzemi1.wordpress.com/2011/06/27/unique-ownership-shared-ownership/">Unique and shared ownership</a></li>
<li><a href="http://stackoverflow.com/questions/13852710/single-vs-shared-ownership-meaning">single vs shared ownership meaning</a></li>
<li><a href="https://www.murrayc.com/permalink/2016/02/10/c-core-guidelines-ownership-and-parameters/">C++ Core Guidelines: Ownership and Parameters</a></li>
<li><a href="https://www.chromium.org/developers/smart-pointer-guidelines">Smart Pointer Guidelines</a></li>
<li><a href="https://google.github.io/styleguide/cppguide.html#Ownership_and_Smart_Pointers">Ownership and Smart Pointers</a></li>
<li><a href="http://www.codeproject.com/Articles/547276/Smart-Pointers-Gotchas">Smart Pointers Gotchas</a></li>
</ul>
<blockquote>
<p>2016-03-03 21:12:19</p>
</blockquote>
<h1>smart pointers in practice</h1>
<h2>use smart pointers as class members</h2>
<ul>
<li><a href="http://stackoverflow.com/questions/15648844/using-smart-pointers-for-class-members">Using smart pointers for class members</a></li>
</ul>
<h2>passing smart pointers</h2>
<ul>
<li><a href="http://herbsutter.com/2013/05/30/gotw-91-smart-pointer-parameters/">GotW #91: Smart Pointer Parameters</a></li>
<li><a href="http://herbsutter.com/2013/06/05/gotw-91-solution-smart-pointer-parameters/">GotW #91 Solution: Smart Pointer Parameters</a>, Guidelines:<ul>
<li>Don’t pass a smart pointer as a function parameter unless you want to use or manipulate the smart pointer itself, such as to share or transfer ownership.</li>
<li>Prefer passing objects by value, <code>*</code>, or <code>&amp;</code>, not by smart pointer.<ul>
<li>Non-owning raw <code>*</code> pointers and <code>&amp;</code> references are okay to observe an object whose lifetime we know exceeds that of the pointer or reference, which is usually true for function parameters. </li>
<li>As usual, use a <code>*</code> if you need to express null, otherwise prefer to use a <code>&amp;</code>; and if the object is input-only, write <code>const widget*</code> or <code>const widget&amp;</code>.</li>
</ul>
</li>
<li><code>void f( unique_ptr&lt;widget&gt; )</code><ul>
<li>Express a “sink” function using a by-value <code>unique_ptr</code> parameter.</li>
<li>Superior to raw pointer because it documents the <strong>semantics</strong> in code.</li>
<li>Because the callee will now own the object, usually there should be no <code>const</code> on the parameter because the const should be irrelevant.</li>
</ul>
</li>
<li><code>void f( unique_ptr&lt;widget&gt;&amp; )</code><ul>
<li>Use a non-const <code>unique_ptr&amp;</code> parameter only to modify the <code>unique_ptr</code>.</li>
<li>Don’t use a const <code>unique_ptr&amp;</code> as a parameter; use <code>widget*</code> instead.</li>
</ul>
</li>
<li><code>void f( shared_ptr&lt;widget&gt; )</code><ul>
<li>Passing <code>shared_ptr</code> by value implies taking shared ownership.</li>
<li>Express that a function will store and share ownership of a heap object using a by-value <code>shared_ptr</code> parameter.</li>
</ul>
</li>
<li><code>void f( shared_ptr&lt;widget&gt;&amp; )</code><ul>
<li>Passing <code>shared_ptr&amp;</code> is useful for in/out shared_ptr manipulation.</li>
<li>Use a non-const <code>shared_ptr&amp;</code> parameter only to modify the <code>shared_ptr</code>.</li>
<li>Use a <code>const shared_ptr&amp;</code> as a parameter only if you’re not sure whether or not you’ll take a copy and share ownership; otherwise use <code>widget*</code> instead (or if not nullable, a <code>widget&amp;</code>).</li>
</ul>
</li>
</ul>
</li>
<li><a href="http://stackoverflow.com/questions/12519812/how-do-i-pass-smart-pointers-into-functions">How do I pass smart pointers into functions? - SO</a></li>
<li><a href="https://www.zhihu.com/question/22821303">C++中方法的参数和返回值、类成员变量什么时候该用原始指针什么时候该用智能指针？</a></li>
</ul>
  </div>
  <div class="article_meta">
    <p>Posted on: 2016-02-26 Fri</p>
    <p>Category: <a href="http://neurocoder.me/category/programming.html">programming</a>
 &ndash; Tags:
      <a href="http://neurocoder.me/tag/c.html">c++</a>    </p>
  </div>

  <div id="article_comments">
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        var disqus_identifier = "posts/2016/02/cpp-smart-pointers.html";
        (function() {
             var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
             dsq.src = '//neurocoder.disqus.com/embed.js';
             (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
         })();
    </script>
  </div>

</article>


    <div id="ending_message">
      <p>&copy; neurocoder. Built using <a href="http://getpelican.com" target="_blank">Pelican</a>. Theme by Giulio Fidente on <a href="https://github.com/gfidente/pelican-svbhack" target="_blank">github</a>. </p>
    </div>
  </main>
</body>
</html>